dependencies:
  override:
    - npm cache clean:
        parallel: true
    - NODE_VERSION=`echo ${!NODEVEREXPR}`; nvm install $NODE_VERSION; rm -fr ./node_modules; PATH=/opt/circleci/nodejs/$NODE_VERSION/bin:$PATH npm cache clean; PATH=/opt/circleci/nodejs/$NODE_VERSION/bin:$PATH npm rebuild:
        parallel: true
    - NODE_VERSION=`echo ${!NODEVEREXPR}`; PATH=/opt/circleci/nodejs/$NODE_VERSION/bin:$PATH npm install:
        parallel: true

test:
  override:
    - NODE_VERSION=`echo ${!NODEVEREXPR}`; PATH=/opt/circleci/nodejs/$NODE_VERSION/bin:$PATH node ./tests/unit/utils/static-srv.js:
        background: true
        parallel: true
    - NODE_VERSION=`echo ${!NODEVEREXPR}`; PATH=/opt/circleci/nodejs/$NODE_VERSION/bin:$PATH node ./tests/unit/utils/wait.js:
        background: true
        parallel: true
    - NODE_VERSION=`echo ${!NODEVEREXPR}`; PATH=/opt/circleci/nodejs/$NODE_VERSION/bin:$PATH node ./server.js:
        background: true
        parallel: true
    - sleep 2:
        parallel: true
    - NODE_VERSION=`echo ${!NODEVEREXPR}`; PATH=/opt/circleci/nodejs/$NODE_VERSION/bin:$PATH npm run eslint-unit-tests-codecov:
        parallel: true
    - NODE_VERSION=`echo ${!NODEVEREXPR}`; PATH=/opt/circleci/nodejs/$NODE_VERSION/bin:$PATH npm run integration-tests:
        parallel: true
    - NODE_VERSION=`echo ${!NODEVEREXPR}`; PATH=/opt/circleci/nodejs/$NODE_VERSION/bin:$PATH npm run functional-tests:
        parallel: true
